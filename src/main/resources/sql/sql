create table retry_task
(
    id                varchar(32)   not null comment '主键ID'
        primary key,
    next_trigger_time bigint        null comment '下次触发时间(毫秒时间戳)',
    retry_count       int default 0 not null comment '已重试次数',
    args              varchar(4096) null comment '业务信息',
    create_at         datetime      null comment '创建时间'
)
    comment '任务重试表';

create index idx_status_next_time
    on retry_task (next_trigger_time);

create table user_scheduled_common_task
(
    id                varchar(32)   not null
        primary key,
    task_id           varchar(64)   not null,
    task_name         varchar(255)  not null comment '任务的名称',
    biz_name          varchar(255)  not null comment '业务名称',
    biz_group         varchar(255)  not null comment '业务团队名称',
    next_trigger_time bigint        null comment '下次触发时间',
    last_trigger_time bigint        null comment '上次触发的时间',
    scheduled_conf    varchar(255)  null comment '定时任务配置',
    scheduled_type    varchar(8)    not null comment '定时任务配置类型1为cron表达式 2为一次触发',
    create_at         datetime      not null,
    update_at         datetime      not null,
    enable            varchar(2)    not null comment '设置状态最后进行批量删除0为失效 1为正常使用',
    payload           varchar(8192) null comment '业务参数用JSON打包',
    topic             varchar(255)  null comment '业务发送Topic默认为公池',
    process           varchar(16)   null comment '临时锁避免业务重复消费 processing是正处理',
    locked_at         bigint        null comment '加锁时间'
);

create index user_combine_index
    on user_scheduled_common_task (biz_name(64), biz_group(64), task_name(64), process, enable, next_trigger_time);

create table user_scheduled_realtime_task
(
    id                varchar(32)   not null
        primary key,
    task_id           varchar(64)   not null,
    task_name         varchar(255)  not null comment '任务的名称',
    biz_name          varchar(255)  not null comment '业务名称',
    biz_group         varchar(255)  not null comment '业务团队名称',
    next_trigger_time bigint        null comment '下次触发时间',
    last_trigger_time bigint        null comment '上次触发的时间',
    scheduled_conf    varchar(255)  null comment '定时任务配置',
    scheduled_type    varchar(8)    not null comment '定时任务配置类型1为cron表达式 2为一次触发',
    create_at         datetime      not null,
    update_at         datetime      not null,
    enable            varchar(2)    not null comment '设置状态最后进行批量删除0为失效 1为正常使用',
    payload           varchar(8192) not null comment '业务参数用JSON打包',
    topic             varchar(255)  null comment '业务发送Topic默认为公池',
    process           varchar(16)   null comment '临时锁避免业务重复消费 processing是正处理',
    constraint user_task_id_uindex
        unique (task_id)
);

create index user_combine_index
    on user_scheduled_realtime_task (biz_name(64), biz_group(64), task_name(64), process, enable, next_trigger_time);

create table xxl_job_lock
(
    lock_name varchar(50) not null comment '锁名称'
        primary key
);

